<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pixel Art</title>
    <style>
        body { display: flex; flex-direction: column; align-items: center; }
        #canvas { display: grid; grid-template-columns: repeat(50, 10px); }
        .pixel { border: 1px solid #ddd; cursor: pointer; }
        button { margin: 5px; }
    </style>
</head>
<body>
    <h1>Pixel Art Canvas</h1>
    <div id="canvas"></div>
    <input type="color" id="colorPicker" value="#000000" />
    <button id="clearCanvas">Clear Canvas</button>
    <button id="viewUsers">View Connected Users</button>
    <input type="number" id="pixelSizeInput" placeholder="Enter new pixel size" min="1"/>
    <button id="setPixelSize">Set Pixel Size</button>
    <div id="userList"></div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        const canvas = document.getElementById('canvas');
        const colorPicker = document.getElementById('colorPicker');
        let pixelSize = 10;

        // Create the canvas grid
        for (let y = 0; y < 50; y++) {
            for (let x = 0; x < 50; x++) {
                const pixel = document.createElement('div');
                pixel.classList.add('pixel');
                pixel.style.width = pixel.style.height = `${pixelSize}px`;
                pixel.dataset.x = x;
                pixel.dataset.y = y;

                pixel.addEventListener('click', function () {
                    const selectedColor = colorPicker.value;
                    placePixel(x, y, selectedColor);
                });

                canvas.appendChild(pixel);
            }
        }

        // Function to place a pixel
        function placePixel(x, y, color) {
            socket.emit('placePixel', { x, y, color });
        }

        // Initialize the canvas with pixel data
        socket.on('init', (pixelData) => {
            pixelData.forEach((row, y) => {
                row.forEach((color, x) => {
                    const pixel = canvas.children[y * 50 + x];
                    pixel.style.backgroundColor = color;
                });
            });
        });

        // Update pixel color when placed
        socket.on('pixelPlaced', ({ x, y, color }) => {
            const pixel = canvas.children[y * 50 + x];
            pixel.style.backgroundColor = color;
        });

        // Clear canvas button
        document.getElementById('clearCanvas').addEventListener('click', function () {
            const password = prompt('Enter admin password:');
            fetch('/admin/clear', {
                method: 'POST',
                headers: {
                    'admin-password': password
                }
            })
            .then(response => {
                if (response.ok) {
                    alert('Canvas cleared.');
                } else {
                    alert('Failed to clear canvas. Check your password.');
                }
            });
        });

        // View connected users button
        document.getElementById('viewUsers').addEventListener('click', function () {
            const password = prompt('Enter admin password:');
            fetch('/admin/users', {
                method: 'GET',
                headers: {
                    'admin-password': password
                }
            })
            .then(response => response.json())
            .then(data => {
                const userList = document.getElementById('userList');
                userList.innerHTML = '';
                data.users.forEach(userId => {
                    const li = document.createElement('li');
                    li.innerText = userId;
                    userList.appendChild(li);
                });
            })
            .catch(error => {
                alert('Failed to fetch users. Check your password.');
            });
        });

        // Set pixel size
        document.getElementById('setPixelSize').addEventListener('click', function () {
            const newSize = document.getElementById('pixelSizeInput').value;
            if (newSize) {
                pixelSize = newSize;
                const pixels = document.querySelectorAll('.pixel');
                pixels.forEach(pixel => {
                    pixel.style.width = pixel.style.height = `${pixelSize}px`;
                });
            }
        });
    </script>
</body>
</html>